---
dist: xenial
language: python
python: 3.7
# pre-commit hooks can use Docker, so we should go ahead and enable it
services: docker
env:
  global:
    # AWS_ACCESS_KEY_ID
    - secure: "KXArOUtX6Sd4UZKx7lrvDlWRX7pKYygpBU7OChV0b4x992JZ9eTwkV/3deps\
      vZpV6TkGLaM7g7DPD4B2ZnPEho8SDM+aF9fmgrox+OYu9j6pwKpDmOzctQwfVCtQAc2gq\
      z4ZVqzm6HXwweiFpQSjG6Ro5Cbre4NRVxOLkBcbJf6hdQjpvgldLC8bxcv9IjN7OUqBT/\
      dmTrgTmzzLq3B1nRjhfSnQqWMSGqIQMQcwdCYyx1rP6t7RB4C5nHHG89dKHwo0c3ofDPs\
      xdQhVmbMDqLqKJoVSBJsDuCFii5RlHJXBhHuXQHIPJ+rLjlzgpGHNgwQvGO77p+6Y0CUo\
      xyH4RUqi+f6ShAiMoppGcnI6QZpciKzOP/CbmeJrjzyui/pc/RsmJrYM5/lHR7+DraAEY\
      UdWbV+vtfqVbZs5Eh2unHlLvJiIjSe+3MxrKpDuKR203T3ti5UaNvsEoY37UpxZR4cswC\
      i68Du5boCEe1uFGb7k7FdZ2ebWxCk8s3eDGf24N7kJ4VByAK5gtLuQAmGVWyrRtbOvDBm\
      xXLYjwOLz2IjpiHhfHKUYg+lD8+BxZoOQP/OiF77nKyGzGlIpI3GgZD04+q0XqXgzYQdc\
      ekdnujiG1Lg+ZiqOZkfIhfGMxFajH07vsNozPPGjNVeIWWAkAxXi2oJW7N1ZiZ60RAawq\
      as="
    - AWS_DEFAULT_REGION="us-east-1"
    # AWS_SECRET_ACCESS_KEY
    - secure: "waZs9uLS3j0qoKKDZV8m8+aUzjjcka5HNSwC8txhLBLRrdxJyCpPPpaxI5Eh\
      aTg4waa3Ac4CSj7ZsvDAsfx/tBzf6zotgUeT05AYHbdoHxtNxMXKv+ibmq/oWD3BqsPKA\
      aH2OE5ZLy2wVir+RdTRy1PFHonI0vTPupaZ049H6WIt0rfTG5O8Y11iYhXyMtA87b5bIT\
      RPqh6ucmsB2/lNpKkABbpMYzJsvv4N8JH9Dth2jRZR3L6RMizPsmwECnwJs4W0hEswILc\
      D+wYqKWrCugWyMJmZqeToiuZ1EKnU3GJBOkg8qcJJMKo2mKSmBhdkdh9AhO9SwMRbtNuQ\
      H43SHIF6zQAgEYiPPU4tHfXRfOXmqPu7Ma/iZBprc9unolnqxUEgCA4xZwx91Y+kzDvek\
      02swr/3oaYWs35b/ZqdrP/dh//F1CMODoNtRHVkcwH9Po20+VrNhrrE9zJRuMbmoEEED8\
      5CZnV9UORXVi3qrAPukVt+d4CitjvvTwbMOKK5EYrp29dAXteLms3l81EXJjtrow8k+XA\
      l4my3Pn3PmaD09dGTOoOjto0bcz1zDHD7pCCM9LHLC6CGw5CWgxzgnFosXCrVPn9gJR8Z\
      t80H8Ohu5OQw4TKh8b2REkFQl2GNvIR6f5G49OgdKykb1YpiyRJqn+7lPwYBDQSS5301A\
      Jc="
    - CURL_CACHE_DIR="$HOME/.cache/curl"
    - TERRAFORM_VERSION="0.12.3"
    - TERRAFORM_ZIP="terraform_${TERRAFORM_VERSION}_linux_amd64.zip"

# Cache pip packages, pre-commit plugins, and some curl downloads to
# speed up builds
cache:
  pip: true
  directories:
    - $HOME/.cache/pre-commit
    - $CURL_CACHE_DIR

before_install:
  # Make a cache directory for curl downloads
  - mkdir -p $CURL_CACHE_DIR
  # Install terraform
  - curl --output "${CURL_CACHE_DIR}/${TERRAFORM_ZIP}"
      --time-cond "${CURL_CACHE_DIR}/${TERRAFORM_ZIP}" --location
      "https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/${TERRAFORM_ZIP}"
  - sudo unzip -d /opt/terraform "${CURL_CACHE_DIR}/${TERRAFORM_ZIP}"
  - sudo ln -s /opt/terraform/terraform /usr/bin/terraform

install:
  - pip install --upgrade -r requirements-test.txt
script:
  - pre-commit run --all-files
  - molecule test
